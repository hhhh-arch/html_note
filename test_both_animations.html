<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥å…·æ å’Œç¼–è¾‘å™¨åŠ¨ç”»ç»¼åˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 50px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .test-highlight {
            background: #ffeb3b;
            padding: 10px;
            margin: 20px 0;
            border-radius: 4px;
            cursor: pointer;
            display: inline-block;
        }
        
        /* æµ®åŠ¨å·¥å…·æ æ ·å¼ */
        .html-note-toolbar-float {
            position: absolute;
            display: flex;
            align-items: center;
            background: #232734;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.22);
            padding: 6px 14px;
            gap: 8px;
            z-index: 10020;
            /* åˆå§‹çŠ¶æ€ï¼šå‘ä¸Šåç§»ï¼Œå‡†å¤‡å‘ä¸‹æ»‘åŠ¨ */
            transform: translate(0, -120%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
            opacity: 0;
        }
        
        .html-note-toolbar-float.show {
            transform: translate(0, 0);
            opacity: 1;
            /* æ·»åŠ è½»å¾®çš„å¼¹æ€§æ•ˆæœ */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
        }
        
        .toolbar-float-btn {
            background: none;
            border: none;
            outline: none;
            border-radius: 6px;
            width: 32px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s;
            color: #fff;
            font-size: 18px;
            margin: 0 2px;
        }
        
        .toolbar-float-btn:hover {
            background: #35394a;
            box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        }
        
        /* ç¬”è®°ç¼–è¾‘å™¨æ ·å¼ */
        .note-editor {
            position: absolute;
            min-width: 340px;
            background: #232734;
            color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.22);
            z-index: 10022;
            border: 1px solid #35394a;
            padding: 0;
            display: flex;
            flex-direction: column;
            /* åˆå§‹çŠ¶æ€ï¼šå‘ä¸‹åç§»ï¼Œå‡†å¤‡å‘ä¸Šæ»‘åŠ¨ */
            transform: translate(0, 120%);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
            opacity: 0;
        }

        .note-editor.show {
            transform: translate(0, 0);
            opacity: 1;
            /* æ·»åŠ è½»å¾®çš„å¼¹æ€§æ•ˆæœ */
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
        }

        .note-editor-header {
            background:#232734;
            padding:14px 18px 0 18px;
            display:flex;
            align-items:center;
            font-size:15px;
            font-weight:500;
            color:#bfc4d1;
            border-radius:12px 12px 0 0;
            flex-wrap: wrap;
            gap: 4px;
            max-width:340px !important;
        }

        .note-editor-textarea {
            width: 100%;
            background: #232734;
            color: #bfc4d1;
            border: none;
            border-radius: 0 0 12px 12px;
            font-size: 15px;
            padding: 16px 18px 18px 18px;
            resize: none;
            overflow: hidden;
            box-sizing: border-box;
            outline: none;
            margin-top: 2px;
            line-height: 1.5;
            height:auto;
            min-height: 56px;
        }

        .note-editor-textarea::placeholder {
            color: #bfc4d1;
            opacity: 0.8;
        }

        .note-editor-tags {
            position:relative;
            background:#232734;
            color:#bfc4d1;
            border:1px solid #35394a;
            border-radius:6px;
            font-size:14px;
            padding:2px 8px;
            outline:none;
            width:120px;
            height:28px;
        }
    </style>
</head>
<body>
    <h1>å·¥å…·æ å’Œç¼–è¾‘å™¨åŠ¨ç”»ç»¼åˆæµ‹è¯•</h1>
    <p>ç‚¹å‡»ä¸‹é¢çš„é«˜äº®æ–‡æœ¬ï¼ŒæŸ¥çœ‹å·¥å…·æ å’Œç¼–è¾‘å™¨çš„æ»‘åŠ¨åŠ¨ç”»æ•ˆæœï¼š</p>
    
    <div class="test-highlight" onclick="showBoth(this, event)">
        è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é«˜äº®æ–‡æœ¬ï¼Œç‚¹å‡»æˆ‘æŸ¥çœ‹å·¥å…·æ å’Œç¼–è¾‘å™¨çš„åŠ¨ç”»æ•ˆæœ
    </div>
    
    <div class="test-highlight" onclick="showBoth(this, event)">
        å¦ä¸€ä¸ªæµ‹è¯•é«˜äº®æ–‡æœ¬ï¼Œå·¥å…·æ ä¼šä»ä¸Šæ–¹æ»‘ä¸‹æ¥ï¼Œç¼–è¾‘å™¨ä¼šä»ä¸‹æ–¹æ»‘ä¸Šæ¥
    </div>
    
    <div class="test-highlight" onclick="showBoth(this, event)">
        ç¬¬ä¸‰ä¸ªæµ‹è¯•æ–‡æœ¬ï¼ŒåŒæ—¶æ˜¾ç¤ºå·¥å…·æ å’Œç¼–è¾‘å™¨
    </div>
    
    <script>
        function showBoth(highlightElement, mouseEvent) {
            // ç§»é™¤å·²å­˜åœ¨çš„å·¥å…·æ å’Œç¼–è¾‘å™¨
            document.querySelectorAll('.html-note-toolbar-float, .note-editor').forEach(el => el.remove());
            
            // åˆ›å»ºå·¥å…·æ 
            const toolbar = document.createElement('div');
            toolbar.className = 'html-note-toolbar-float';
            
            // åˆ›å»ºç¼–è¾‘å™¨
            const editor = document.createElement('div');
            editor.className = 'note-editor';
            editor.innerHTML = `
                <div class="note-editor-header">
                    <input type="text" class="note-editor-tags" placeholder="Tags" />
                </div>
                <textarea class="note-editor-textarea" rows="1" placeholder="type your note"></textarea>
            `;
            
            // è®¡ç®—ä½ç½®
            const rect = highlightElement.getBoundingClientRect();
            const scrollX = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollY = window.pageYOffset || document.documentElement.scrollTop;
            
            // å·¥å…·æ ä½ç½®ï¼ˆä¸Šæ–¹ï¼‰
            const toolbarLeft = mouseEvent.clientX + scrollX - 90;
            const toolbarTop = mouseEvent.clientY + scrollY - 50;
            
            // ç¼–è¾‘å™¨ä½ç½®ï¼ˆä¸‹æ–¹ï¼‰
            const editorLeft = mouseEvent.clientX + scrollX - 170;
            const editorTop = mouseEvent.clientY + scrollY + 15;
            
            // è®¾ç½®å·¥å…·æ ä½ç½®
            toolbar.style.left = `${toolbarLeft}px`;
            toolbar.style.top = `${toolbarTop}px`;
            document.body.appendChild(toolbar);
            
            // è®¾ç½®ç¼–è¾‘å™¨ä½ç½®
            editor.style.left = `${editorLeft}px`;
            editor.style.top = `${editorTop}px`;
            editor.style.position = 'absolute';
            document.body.appendChild(editor);
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            requestAnimationFrame(() => {
                toolbar.classList.add('show');
                editor.classList.add('show');
            });
            
            // åˆ›å»ºå·¥å…·æ æŒ‰é’®
            const colorBtn = document.createElement('button');
            colorBtn.className = 'toolbar-float-btn';
            colorBtn.innerHTML = 'ğŸ¨';
            colorBtn.title = 'æ›´æ”¹é¢œè‰²';
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'toolbar-float-btn';
            copyBtn.innerHTML = 'ğŸ“‹';
            copyBtn.title = 'å¤åˆ¶æ–‡æœ¬';
            
            const noteBtn = document.createElement('button');
            noteBtn.className = 'toolbar-float-btn';
            noteBtn.innerHTML = 'ğŸ“';
            noteBtn.title = 'æ·»åŠ ç¬”è®°';
            
            const delBtn = document.createElement('button');
            delBtn.className = 'toolbar-float-btn';
            delBtn.innerHTML = 'ğŸ—‘ï¸';
            delBtn.title = 'åˆ é™¤é«˜äº®';
            
            // æ·»åŠ æŒ‰é’®åˆ°å·¥å…·æ 
            toolbar.append(colorBtn, copyBtn, noteBtn, delBtn);
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            setTimeout(() => {
                document.addEventListener('mousedown', function closeBoth(ev) {
                    if (!toolbar.contains(ev.target) && !editor.contains(ev.target) && !highlightElement.contains(ev.target)) {
                        toolbar.remove();
                        editor.remove();
                        document.removeEventListener('mousedown', closeBoth);
                    }
                });
            }, 10);
            
            // è‡ªåŠ¨èšç„¦åˆ°æ–‡æœ¬æ¡†
            const textarea = editor.querySelector('.note-editor-textarea');
            textarea.focus();
        }
    </script>
</body>
</html> 